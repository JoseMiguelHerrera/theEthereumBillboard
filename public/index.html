<!doctype html>
<html>

<head>
    <title>bitscreen</title>
    <script src="js/contractdetails.js"></script>
    <script src="js/web3.js"></script>
    <script src="js/bitscreen.js"></script>
    <script src="js/hashFuncs/bundle.js"></script>

    <script type="text/javascript">
        var bitscreen;
        var currHash = null;
        var pollrate = 10;
        window.addEventListener('load', function () {
            checkMetamask().then(() => {
                getContract().then(contract => {
                    bitscreen = contract;
                    pollContract().then((data) => {
                        document.getElementById("countdown").innerText = 0;
                    })
                    setInterval(function () {
                        pollContract().then((data) => {
                            console.log("polled contract")
                            document.getElementById("countdown").innerText = 0;
                        })
                    }, pollrate * 1000)
                    setInterval(function () {
                        document.getElementById("countdown").innerText = parseInt(document.getElementById("countdown").innerText) + 1;
                    }, 1000);
                }).catch(err => {
                    alert(err)
                })
            }).catch(err => {
                alert(err)
            })
        })
    </script>
</head>

<body>
    <h1>bitscreen alpha</h1>

    <h2>Seconds since last smart contract poll:
        <span id="countdown"></span>
    </h2>

    <h2 id="currHashSolidity">Current IPFS image hash (from smart contract): - </h2>
    <h2 id="currScreenHolder">Current holder of screen (from smart contract): - </h2>
    <h2 id="currDestination">Current proposed destination of funds (from smart contract): - </h2>
    <h2 id="currLargestAmount">Current largest amount sent (from smart contract): - </h2>

    <br>
    <br>
    <br>

    <h2>Current image (from smart contract hash): </h2>
    <img src="" id="currimg" />

    <h2>Change current image: </h2>

    <form method="post" onsubmit="return sendnewpic()" enctype="multipart/form-data" id="picform">
        <div>
            <label for="etherAmount">Choose ether amount to send: </label>
            <input type="number" required min="0" value="0" step="0.000000000000000001" id="etherAmount">
            <br>
            <label for="etherDest">Choose where you'd like the ether to go at the end: </label>
            <input type="text" required id="etherDest" placeholder="charity">
            <br>
            <label for="nextpic">Choose jpg/png pic to upload: </label>
            <input required type="file" id="nextpic" name="image" accept="image/jpeg, image/png">
        </div>
        <div>
            <button>Submit</button>
        </div>
    </form>

</body>

</html>